<!DOCTYPE HTML>
<html>
<head>
<script type="text/javascript" src="http://yandex.st/jquery/1.9.1/jquery.js"></script>
<script type="text/javascript">

function getURLParameter(name) {
  return decodeURIComponent(
    (location.search.match(RegExp("[?|&]"+name+'=(.+?)(&|$)'))||[,null])[1]
  );
}

  // Let us open a web socket
  var ws = new WebSocket("ws://localhost:8080/games/" + getURLParameter("id"));

  ws.onopen = function() {
    // Web Socket is connected, send data using send()
    console.log("Message is sent...");
  };

  ws.onmessage = function (evt) {
    window.res = $.parseJSON(evt.data);
    if (res.action == "joined") {
      console.log("вы игрок номер:" + res.data.player);
      if (res.data.player == 1) {
        window.figure = 'x';
      } else {
        window.figure = 'o';
      };
    };
    if (res.action == "moved") {
      var tr = $("table tr").eq(res.data.y - 1);
      tr.children().eq(res.data.x - 1).html(1);
    };

    if (res.action == "result") {
      if (res.data == "lost") {
        alert("вы повержены");
      } else {
        alert("вы победили");
      };
    };

  };

  ws.onclose = function()
  { 
    // websocket is closed.
    console.log("Connection is closed..."); 
  };

  $(function(){
    $("td").click(function(el) {
      var td = $(el.currentTarget);
      td.html(window.figure);
      var x = td.parent().children().index(td);
      var y = $("table tr").index(td.parent());
      ws.send('{"x":' + (x + 1) + "," + '"y":' + (y + 1) + "}");
    });
  });
</script>
</head>
<body>
<table border="1" width="300" height="300" style="text-align:center;padding:0;margin:0;">
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
</table>
</body>
</html>
